import*as e from"@wordpress/interactivity";var t={d:(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const r=(a={getContext:()=>e.getContext,store:()=>e.store},n={},t.d(n,a),n),{actions:s,state:o}=(0,r.store)("wporg/showcase/screenshot",{state:{get attempts(){return(0,r.getContext)().attempts},get shouldRetry(){return(0,r.getContext)().shouldRetry},get base64Image(){return(0,r.getContext)().base64Image},get hasError(){return(0,r.getContext)().hasError},get hasLoaded(){return o.base64Image||o.hasError}},actions:{increaseAttempts(){(0,r.getContext)().attempts++},setShouldRetry(e){(0,r.getContext)().shouldRetry=e},setHasError(e){(0,r.getContext)().hasError=e},setBase64Image(e){(0,r.getContext)().base64Image=e},*fetchImage(e){try{const t=yield fetch(e);if(s.increaseAttempts(),t.redirected)s.setShouldRetry(!0);else if(200===t.status&&!t.redirected){const e=yield t.blob(),r=yield new Promise((t=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)}));s.setBase64Image(r),s.setShouldRetry(!1)}}catch(e){s.setHasError(!0),s.setShouldRetry(!1)}}},callbacks:{*init(){const{isMShots:e,src:t}=(0,r.getContext)();if(e&&!o.base64Image)for(yield s.fetchImage(t);o.shouldRetry;)yield new Promise((e=>{setTimeout((()=>e()),2e3)})),yield s.fetchImage(t),o.attempts>=10&&(s.setHasError(!0),s.setShouldRetry(!1))}}});var a,n;